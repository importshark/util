(()=>{const e=document.getElementById("actiondiv");let i,n,t,o=document.getElementById("shark"),d=document.getElementById("imgholder"),l=document.getElementById("infoholder"),a=document.getElementById("ofidiv"),c=0;const s=["Control","CapsLock","Shift","Enter","Space","!","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12",":",",","?",".","`","~","[","]","{","}","'",'"',"\\","|","/"];let r,f,h,m,g={initialtype:!0},p="start";function u(e){if(console.log(`${e} was clicked in state ${p}`),"button"==states[p].div.inttype)switch(p){case"error":w("start");break;case"preauth":"child"===e&&window.electronAPI.emit("auth-show");break;case"preauthinfo":switch(e){case"child":w("preauth");break;case"ofi":w("typetime")}break;case"loadfail":switch(e){case"child":w("preauth");break;case"ofi":w("preauthinfo")}break;case"typetime":switch(e){case"child":if("-><-"==t.innerText||"<-"==t.innerText.substring(2).trim())return w("typeerror500");g.username=t.innerText,w("prepmc");break;case"ofi":w("preauthinfo")}break;case"typeerror404":case"typeerror500":w("typetime")}}function v(e){if(console.log(`Type event ${e} recieved in state ${p}`),console.log(e),"typetime"==p&&!s.includes(e.key))if(g.initialtype&&(t.innerText="-><-",g.initialtype=!1),"v"==e.key.toLowerCase()&&e.ctrlKey)navigator.clipboard.readText().then((e=>{let i=t.innerText.split("");i.pop(),i.pop(),t.innerText=i.join(""),t.innerText+=e,t.innerText+="<-"}));else{if("backspace"==e.key.toLowerCase()){let e=t.innerText.split("");if(e.pop(),e.pop(),e.pop(),e.length<2)return;return t.innerText=`${e.join("").toString()}<-`}{let i=t.innerText.split("");i.pop(),i.pop(),t.innerText=i.join(""),t.innerText+=e.key,t.innerText+="<-"}}}function y(){let e=states[p];t=document.getElementById(e.child.id),i=document.getElementById(e.offhandicon.id),a=document.getElementById("ofidiv"),o=document.getElementById(e.image.id),d=document.getElementById(e.imagediv.id),n=document.getElementById(e.info.id),console.log(r),"button"==states[p].div.inttype&&(t.style.backgroundColor="#00008b"),"button"!=states[p].div.inttype||r||(r=!0,t.addEventListener("mouseenter",(()=>{"button"==states[p].div.inttype&&(t.style.backgroundColor="#000075")})),f=!0,t.addEventListener("mouseleave",(()=>{"button"==states[p].div.inttype&&(t.style.backgroundColor="#00008b")})),h=!0,t.addEventListener("click",(()=>{console.log("clicke"),u("child")}))),e.offhandicon.class.includes("nonexistent")||m||(m=!0,i.addEventListener("click",(()=>{u("ofi")})));const l=states[p].actions;for(let e=0;e<l.length;e++){const{action:i,value:n,extra:t}=l[e];switch(i){case"emit":"username"===t?(console.log("prep-mc sent"),window.electronAPI.emit(n,g.username)):window.electronAPI.emit(n,t);break;case"set":g[n]=t}}document.onkeyup=v}function w(s,r){console.log(`Recieved update ${s}`),p!=s&&states[s]&&(c>=3&&"wifilost"!=s||(console.log("loading said state"),function(){let e=document.getElementById("cover");e.classList.remove("nonexistent"),e.classList.add("transition"),setTimeout((()=>{e.classList.add("nonexistent"),e.classList.remove("transition")}),500)}(),setTimeout((()=>{const c=states[p].div.type;t=document.getElementById(states[p].child.id),i=document.getElementById(states[p].offhandicon.id);let f=states[s];p=s,r&&(r.div&&(f.div.type=r.div.type?r.div.type:f.div.type,f.div.inttype=r.div.inttype?r.div.inttype:f.div.inttype,f.div.class=r.div.class?r.div.class:f.div.class),r.child&&(f.child.div=r.child.div?r.child.div:f.child.div,f.child.class=r.child.class?r.child.class:f.child.class,f.child.id=r.child.id?r.child.id:f.child.id,f.child.innerHtml=r.child.innerHtml?r.child.innerHtml:f.child.innerHtml),r.offhandicon&&(f.offhandicon.div=r.offhandicon.div?r.offhandicon.div:f.offhandicon.div,f.offhandicon.class=r.offhandicon.class?r.offhandicon.class:f.offhandicon.class,f.offhandicon.id=r.offhandicon.id?r.offhandicon.id:f.offhandicon.id,f.offhandicon.alt=r.offhandicon.alt?r.offhandicon.alt:f.offhandicon.alt,f.offhandicon.src=r.offhandicon.src?r.offhandicon.src:f.offhandicon.src),r.info&&(f.info.div=r.info.div?r.info.div:f.info.div,f.info.class=r.info.class?r.info.class:f.info.class,f.info.id=r.info.id?r.info.id:f.info.id,f.info.innerHtml=r.info.innerHtml?r.info.innerHtml:f.info.innerHtml),r.image&&(f.image.div=r.image.div?r.image.div:f.image.div,f.image.class=r.image.class?r.image.class:f.image.class,f.image.id=r.image.id?r.image.id:f.image.id,f.image.alt=r.image.alt?r.image.alt:f.image.alt,f.image.src=r.image.src?r.image.src:f.image.src),r.imagediv&&(f.imagediv.id=r.imagediv.id?r.imagediv.id:f.imagediv.id,f.imagediv.class=r.imagediv.class?r.imagediv.class:f.imagediv.class)),e.className="";for(let i=0;i<f.div.class.length;i++){const n=f.div.class[i];e.classList.add(n)}switch(t.className="",c===f.div.type){case!0:for(let e=0;e<f.child.class.length;e++){const i=f.child.class[e];t.classList.add(i)}t.id=f.child.id,t.innerHTML=f.child.innerHtml,t.style.backgroundColor="";break;case!1:t.remove();const i=document.createElement(f.div.type);for(let e=0;e<f.child.class.length;e++){const n=f.child.class[e];i.classList.add(n)}i.id=f.child.id,i.innerHTML=f.child.innerHtml,e.appendChild(i),t=i}if(f.child.div){let i=!1;for(let n=0;n<e.children.length;n++)e.children[n].id===states[p].child.id&&(i=!0);i||e.appendChild(t)}else{try{e.removeChild(t)}catch(e){console.warn("Failed to remove child from actiondiv. This may be an error but most likely is normal operation.")}document.body.appendChild(t)}i.className="";for(let e=0;e<f.offhandicon.class.length;e++){const n=f.offhandicon.class[e];i.classList.add(n)}if(i.id=f.offhandicon.id,i.src=f.offhandicon.src,i.alt=f.offhandicon.alt,f.offhandicon.div){let e=!1;for(let i=0;i<a.children.length;i++)a.children[i].id===states[p].offhandicon.id&&(e=!0);e||a.appendChild(i)}else{try{a.removeChild(i)}catch(e){console.warn("Failed to remove child from actiondiv. This may be an error but most likely is normal operation.")}document.body.appendChild(i)}d.className="",d.id=f.imagediv.id;for(let e=0;e<f.imagediv.class.length;e++){const i=f.imagediv.class[e];d.classList.add(i)}if(f.image.div){let e=!1;for(let i=0;i<d.children.length;i++)d.children[i].id===states[p].image.id&&(e=!0);e||d.appendChild(o)}else{try{o.removeChild(o)}catch(e){console.warn("Failed to remove image from imageholder. This may be an error but most likely is normal operation.")}document.body.appendChild(o)}o.className="",o.src=f.image.src,o.id=f.image.id;for(let e=0;e<f.image.class.length;e++){const i=f.image.class[e];o.classList.add(i)}n.className="",n.id=f.info.id,n.innerHTML=f.info.innerHtml;for(let e=0;e<f.info.class.length;e++){const i=f.info.class[e];n.classList.add(i)}if(f.info.div){let e=!1;for(let i=0;i<l.children.length;i++)l.children[i].id===states[p].info.id&&(e=!0);e||l.appendChild(n)}else{try{l.removeChild(n)}catch(e){console.warn("Failed to remove info from holder. This may be an error but most likely is normal operation.")}document.body.appendChild(n)}y()}),250)))}function b(){var e;(e="has-token",new Promise(((i,n)=>{window.electronAPI.emit(e,undefined),window.electronAPI.handle(e+"-res",(e=>{i(e)})),setTimeout((()=>{n()}),3e3)}))).then((e=>{const{code:i,token:n}=e;i?w(n?"prepmc":"postauth"):g.username?w("prepmc"):w("preauthinfo")}))}console.log(window.electronAPI),y(),window.electronAPI.emit("proc-begin"),document.getElementById("backgroundButton").addEventListener("click",(function(){window.electronAPI.emit("window-hide","hide")})),document.getElementById("exitButton").addEventListener("click",(function(){console.log("close"),window.electronAPI.emit("window-close","close")})),window.electronAPI.handle("update",(function(e){console.info(e)})),window.electronAPI.handle("test",(()=>{console.log("test")})),window.electronAPI.handle("auth-show",(()=>{w("postAuth")})),window.electronAPI.handle("auth-done",(()=>{"loadfail"!=p&&b()})),window.electronAPI.handle("auth-close",(e=>{e?function(e){let i=[],n=!1,t=e.toString();t=t.substring(t.indexOf("Error")+7),console.log(t),t.split("").forEach((e=>{if(" "==e){if(n)return;n=!0,w("loadfail",{info:{innerHtml:"Loading the authorization page failed. The error is: "+i.join("")}})}else i.push(e.toLowerCase())}))}(e):b()})),window.electronAPI.handle("wifi",(e=>{console.info(`Wifi status ${e}`),e?(c=0,"wifilost"==p&&b()):(c++,c>=3&&"errorunsolve"!=p&&w("wifilost"))})),window.electronAPI.handle("proc-done",b),window.electronAPI.handle("ready",b),window.electronAPI.handle("mc-ready",console.log),window.electronAPI.handle("mc-close",(function(){console.log("Minecraft closed")})),window.electronAPI.handle("mc-fail",(function(e){console.log("Minecraft failed "+e)}))})();